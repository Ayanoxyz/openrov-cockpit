<dom-module name="telemetry-item">
<style>
.std {
  background-color: black;
  color: white;
  width: 100px;
  height: 40px;
  line-height: 40px;
  font-size: 2vw;
}
</style>
  <template>
  <div on-click="toggle">
  <link href="../grapp-graph-epoch/grapp-graph-epoch.html" rel="import">
    <grapp-graph-epoch id="timegraph" hidden="{{!enabled}}" type="time.line" axis="" width="100" height="40">
      <grapp-graph-epoch-series label="Time Series 1"
        data='[{"time":1370044800,"y":1},{"time":1370044801,"y":10}]'>
      </grapp-graph-epoch-series>
    </grapp-graph-epoch>
  <span id="instantvalue" hidden="{{enabled}}" class="std">{{telemetryItemValue}}</span>
</div>
  </template>

  <script>
    (function() {

      Polymer({
        is:'telemetry-item',
        properties:{
          telemetry: {type:Object},
          telemetryItem: {type:String},
          telemetryItemValue: {type:String, observer: 'telemetryItemValueChanged'},
          eventEmitter: {type: Object, readOnly: true, observer: 'eventEmitterChange'},
          enabled: {type: Boolean, value: true}
        },
        ready: function () {
          if(this.eventEmitter !== undefined){
            //var result = this.notifyPath('eventEmitter',this.eventEmitter);
            this.eventEmitterHasChanged(null,this.eventEmitter);
          }
        },
        telemetryItemValueChanged: function(oldvalue,newvalue){
          //should update graph
        },
        eventEmitterHasChanged: function(oldvalue,newvalue){
          var self=this;

          if (this.dataupdate===undefined){
            this.dataupdate = function(data){
              self.logStatusData(data);
            }
          }

          if(oldvalue !== null){
            oldvalue.off('plugin.telemetry.logData',this.dataupdate)
          }
          this.eventEmitter.on('plugin.telemetry.logData',this.dataupdate);
          //Todo: Dereference the old listener on the old emitter
        },
        logStatusData: function (data) {
          var t = Object.keys(data)
          for (var i in t) {
            if (this.telemetryItem == t[i]){
              if (!Number.isNaN(data[t[i]])){
                if (this.$.timegraph.push !== undefined){
                  this.$.timegraph.push((new Date()).getTime()/1000, data[t[i]]);
                }
              }
              this.telemetryItemValue = data[t[i]];
            }
          }
        },
        toggle: function(){
          this.enabled = !this.enabled;
        }
      })
    })();
  </script>

</dom-module>
